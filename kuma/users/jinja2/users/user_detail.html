{% extends "base.html" %}

{% set display_name = user_display(detail_user) %}
{% set is_me = user.pk == detail_user.pk %}

{% block body_attributes %}{% endblock %}

{% block bodyclass %}user user-display{% endblock %}

{% block title %}{{ page_title(detail_user) }}{% endblock %}

{% block site_css %}
  {{ super() }}
  {% stylesheet 'jquery-ui' %}
  {% stylesheet 'users' %}
{% endblock %}

{% block content %}
<section id="content">
<div class="wrap">

  <section id="content-main" class="full">
    <section id="user-head" class="column-container column-container-reverse vcard user-head">
      <div class="column-10">
        <h1 class="user-title">
            <span class="nickname">{{ detail_user.username }}</span>
            {% if detail_user.fullname %}
                <b class="user-title-fullname">(<span class="fn">{{ detail_user.fullname }}</span>)</b>
            {% endif %}
            {% if user.is_authenticated() and is_me %}
                {% include 'socialaccount/snippets/login_service_icon.html' %}
            {% endif %}
        </h1>

        <div class="user-buttons">
          {% if not is_me and user.has_perm('users.add_userban') %}
            {{ ban_link(detail_user, user) }}
          {% endif %}

          {% if user.is_superuser %}
            {{ admin_link(detail_user) }}
          {% endif %}

          <!-- Only shown for the user and admins -->
          {% if detail_user.allows_editing_by(user) %}
              <a id="edit-user" href="{{ url('users.user_edit', username=detail_user.username) }}" class="button neutral">{{ _("Edit") }}<i aria-hidden="true" class="icon-pencil"></i></a>
              {% if is_me %}
              <button id="advanced-menu" class="neutral only-icon" {{ disabled_attr }} aria-haspopup="true" aria-owns="advanced-menu-submenu" aria-expanded="false"><span>{{ _('Advanced') }}</span><i aria-hidden="true" class="icon-cog"></i></button>
              <div class="submenu js-submenu" id="advanced-menu-submenu">
                <!-- this page -->
                <div class="submenu-column">
                  <div class="title">{{ _('Manage') }}</div>
                  <ul>
                    <li><a href="{{ url('socialaccount_connections') }}" class="neutral">{{ _("Account connections") }}</a></li>
                    <li><a href="{{ url('authkeys.list') }}" class="neutral">{{ _("API keys") }}</a></li>
                    <li><a href="{{ url('account_email') }}" class="neutral">{{ _("Email addresses") }}</a></li>
                  </ul>
                </div>
              </div>
              {% endif %}
          {% endif %}
        </div>

     {% with accounts=social_accounts(detail_user) %}
       {% include "users/includes/user_profile_data.html" %}
     {% endwith %}

      </div>
    </section>

          <section id="docs-activity" class="user-section">
            <header>
              <h2>{{ _("Recent Docs Activity") }}</h2> <a href="{{ url('dashboards.revisions') }}?user={{ detail_user.username }}" class="button">{{ _('View all activity') }}</a>
            </header>

            <table class="activity">
              <thead>
                <th scope="col" class="activity-page">{{ _("Page") }}</th>
                <th scope="col" class="activity-date">{{ _("Date") }}</th>
                <th scope="col" class="activity-summary">{{ _("Comment") }}</th>
              </thead>
              <tbody>
                {% for revision in detail_user.wiki_revisions() %}
                <tr>
                  <th scope="row">
                      <h3><a href="{{ revision.document.get_absolute_url() }}">{{ revision.document.title }}</a></h3>
                      <ul class="activity-actions">
                          <li><a href="{{ revision.document.get_edit_url() }}" class="edit">{{ _("Edit page") }}</a></li>
                          <li>{% if revision.previous %}<a href="{{ url('wiki.compare_revisions', revision.document.slug, locale=revision.document.locale) }}?from={{ revision.previous.id }}&amp;to={{ revision.id }}" rel="nofollow, noindex" class="diff">{{ _("View complete diff") }}</a>{% endif %}</li>
                          <li><a href="{{ url('wiki.document_revisions', revision.document.slug, locale=revision.document.locale) }}" class="history">{{ _("View page history") }}</a></li>
                      </ul>
                  </th>
                  <td>{{ datetimeformat(revision.created, format='date') }}<br />
                      {{ datetimeformat(revision.created, format='time') }}</td>
                  {# TODO: auto-generate smart comment like "N words changed." #}
                  <td>{{ format_comment(revision, previous_revision=revision.previous) }}</td>
                </tr>
                {% else %}
                <tr>
                    <th scope="row">
                    {% if is_me %}
                        {% trans docs_url=wiki_url('Project:MDN/Contributing/Creating_and_editing_pages') %}
                        <p class="none">You haven't contributed to any MDN docs. <a href="{{ docs_url }}">Pitch in!</a></p>
                        {% endtrans %}
                    {% else %}
                        <p class="none">{{ _('This user has no activity.') }}</p>
                    {% endif %}
                    </th>
                </tr>
                {% endfor %}
              </tbody>
              <tfoot>
              </tfoot>
            </table>
          </section>

  </section><!-- /#content-main -->
</div>
</section>
{% endblock %}
